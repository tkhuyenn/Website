{"remainingRequest":"D:\\NEU\\CDTT\\frontend\\Website\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\NEU\\CDTT\\frontend\\Website\\src\\modules\\setting\\components\\popup\\PopupVerifiedSms.vue?vue&type=script&lang=ts&","dependencies":[{"path":"D:\\NEU\\CDTT\\frontend\\Website\\src\\modules\\setting\\components\\popup\\PopupVerifiedSms.vue","mtime":1660123011575},{"path":"D:\\NEU\\CDTT\\frontend\\Website\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1660970364629},{"path":"D:\\NEU\\CDTT\\frontend\\Website\\node_modules\\babel-loader\\lib\\index.js","mtime":1660970387821},{"path":"D:\\NEU\\CDTT\\frontend\\Website\\node_modules\\ts-loader\\index.js","mtime":1660970390648},{"path":"D:\\NEU\\CDTT\\frontend\\Website\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1660970364629},{"path":"D:\\NEU\\CDTT\\frontend\\Website\\node_modules\\vue-loader\\lib\\index.js","mtime":1660970394220}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgppbXBvcnQgeyBDb21wb25lbnQsIE1peGlucywgUHJvcCwgV2F0Y2ggfSBmcm9tICd2dWUtcHJvcGVydHktZGVjb3JhdG9yJwppbXBvcnQgUG9wdXBNaXhpbiBmcm9tICdAL21peGlucy9wb3B1cCcKCmltcG9ydCBnZXRSZXBvc2l0b3J5IGZyb20gJ0Avc2VydmljZXMnCmltcG9ydCBXYWxsZXRSZXBvc2l0b3J5IGZyb20gJ0Avc2VydmljZXMvcmVwb3NpdG9yaWVzL3dhbGxldCcKaW1wb3J0IHsgU2V0dGluZ1JlcG9zaXRvcnkgfSBmcm9tICdAL3NlcnZpY2VzL3JlcG9zaXRvcmllcy9zZXR0aW5nJwppbXBvcnQgeyBBdXRoUmVwb3NpdG9yeSB9IGZyb20gJ0Avc2VydmljZXMvcmVwb3NpdG9yaWVzL2F1dGgnCmltcG9ydCBkZWJvdW5jZSBmcm9tICdsb2Rhc2gvZGVib3VuY2UnCmltcG9ydCB7IG5hbWVzcGFjZSB9IGZyb20gJ3Z1ZXgtY2xhc3MnCmltcG9ydCB7IElVc2VyIH0gZnJvbSAnQC9pbnRlcmZhY2UnCmltcG9ydCBpbmNsdWRlcyBmcm9tICdsb2Rhc2gvaW5jbHVkZXMnCmNvbnN0IGJjQXV0aCA9IG5hbWVzcGFjZSgnYmVBdXRoJykKY29uc3QgYXBpQXV0aDogQXV0aFJlcG9zaXRvcnkgPSBnZXRSZXBvc2l0b3J5KCdhdXRoJykKY29uc3QgYXBpOiBTZXR0aW5nUmVwb3NpdG9yeSA9IGdldFJlcG9zaXRvcnkoJ3NldHRpbmcnKQpAQ29tcG9uZW50CmV4cG9ydCBkZWZhdWx0IGNsYXNzIFBvcHVwVmVyaWZ5U21zIGV4dGVuZHMgTWl4aW5zKFBvcHVwTWl4aW4pIHsKICBAYmNBdXRoLlN0YXRlKCd1c2VyJykgdXNlciE6IElVc2VyCiAgQFByb3AoeyByZXF1aXJlZDogdHJ1ZSwgdHlwZTogT2JqZWN0LCBkZWZhdWx0OiAoKSA9PiAoe30pIH0pIGluZm8hOiBSZWNvcmQ8c3RyaW5nLCBhbnk+CgogIGZvcm06IFJlY29yZDxzdHJpbmcsIGFueT4gPSB7CiAgICBjb2RlOiAnJwogIH0KICBpc0xvYWRpbmcgPSBmYWxzZQogIHN1Y2Nlc3M6IGFueSA9IDAKICBydWxlczogUmVjb3JkPHN0cmluZywgYW55PiA9IHsKICAgIGNvZGU6IFsKICAgICAgewogICAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgICAgIG1lc3NhZ2U6IHRoaXMuJHQoJ3ZlcmlmeS53cm9uZy1jb2RlJyksCiAgICAgICAgdHJpZ2dlcjogJ2JsdXInCiAgICAgIH0sCiAgICAgIHsKICAgICAgICBsZW46IDYsCiAgICAgICAgbWVzc2FnZTogdGhpcy4kdCgnY2hhbmdlUGFzc3dvcmQuZXJyb3JMZW5ndGhWZXJpZmljYXRpb25Db2RlJyksCiAgICAgICAgdHJpZ2dlcjogJ2JsdXInCiAgICAgIH0KICAgIF0KICB9CiAgZ2V0IGdldERpc2FibGVCdG4oKTogYm9vbGVhbiB7CiAgICByZXR1cm4gdGhpcy5mb3JtLmNvZGUubGVuZ3RoICE9PSA2CiAgfQoKICBAV2F0Y2goJ2Zvcm0uY29kZScpIHdhdGNoQ29kZShjb2RlOiBzdHJpbmcpOiB2b2lkIHsKICAgIGlmIChjb2RlKSB7CiAgICAgIC8vQHRzLWlnbm9yZQogICAgICB0aGlzLiRyZWZzWydmb3JtLXZlcmlmeSddPy5jbGVhclZhbGlkYXRlKCkKICAgIH0KICB9CgogIC8vIGRlYm91bmNlIGNoYW4gZG9ibGUgY2xpY2sKICBkZWJvdW5jZUZpbHRlciA9IGRlYm91bmNlKChuYW1lQWN0aW9uOiBhbnkpID0+IHsKICAgIGlmIChuYW1lQWN0aW9uID09ICdoYW5kbGVSZXNlbmRDb2RlJykgewogICAgICB0aGlzLnJlc2VuZENvZGUoKQogICAgfQogICAgaWYgKG5hbWVBY3Rpb24gPT0gJ2hhbmRsZVN1Ym1pdCcpIHsKICAgICAgdGhpcy5zdWJtaXQoKQogICAgfQogIH0sIDQwMCkKICBoYW5kbGVSZXNlbmRDb2RlKCk6IHZvaWQgewogICAgdGhpcy5kZWJvdW5jZUZpbHRlcignaGFuZGxlUmVzZW5kQ29kZScpCiAgfQogIHB1c2hOb3RpZmkgPSBmYWxzZQogIGFzeW5jIHJlc2VuZENvZGUoKTogUHJvbWlzZTx2b2lkPiB7CiAgICB0aGlzLnB1c2hOb3RpZmkgPSB0cnVlCiAgICB0aGlzLmhhbmRsZVNlbmRDb2RlKCkKICB9CiAgaGFuZGxlQ2FsbFNlbmRDb2RlKCk6IHZvaWQgewogICAgYXBpLmdldFByb2ZpbGUoKS50aGVuKChyZXM6IGFueSkgPT4gewogICAgICBjb25zdCBkYXRhID0gewogICAgICAgIGNvdW50cnk6IHJlcy5kYXRhLmNvdW50cnksCiAgICAgICAgcGhvbmU6IHRoaXMuaW5mby5waG9uZSwKICAgICAgICBjb3VudHJ5Q29kZTogcmVzLmRhdGEuY291bnRyeUNvZGUsCiAgICAgICAgZW1haWw6IHRoaXMuaW5mby5lbWFpbCwKICAgICAgICBwaG9uZUNhbGw6IHRydWUKICAgICAgfQogICAgICBsZXQgbWVzc2FnZTogYW55ID0gJycKICAgICAgYXBpQXV0aC52ZXJpZnlQaG9uZShkYXRhKS50aGVuKCgpID0+IHsKICAgICAgICBtZXNzYWdlID0gdGhpcy4kdCgnbm90aWZ5LnNlbmQtY29kZS12b2ljZScpCiAgICAgICAgdGhpcy4kbWVzc2FnZS5zdWNjZXNzKHsgbWVzc2FnZSwgZHVyYXRpb246IDUwMDAgfSkKICAgICAgfSkKICAgIH0pCiAgfQogIGhhbmRsZVJlc2V0KCk6IHZvaWQgewogICAgLy9AdHMtaWdub3JlCiAgICB0aGlzLiRyZWZzWydmb3JtLXZlcmlmeSddPy5jbGVhclZhbGlkYXRlKCkKICAgIHRoaXMuZm9ybSA9IHsKICAgICAgY29kZTogJycKICAgIH0KICB9CiAgaGFuZGxlQ2xvc2UoKTogdm9pZCB7CiAgICB0aGlzLmhhbmRsZVJlc2V0KCkKICB9CgogIGFzeW5jIGhhbmRsZVNlbmRDb2RlKCk6IFByb21pc2U8dm9pZD4gewogICAgdHJ5IHsKICAgICAgY29uc3QgZGF0YSA9IHsKICAgICAgICBlbWFpbDogdGhpcy5pbmZvLmVtYWlsLAogICAgICAgIHR5cGU6ICdTTVMnLAogICAgICAgIHJlYXNvbjogJycKICAgICAgfQogICAgICBhd2FpdCBhcGlBdXRoLnJlc2VuZENvZGUoZGF0YSkudGhlbigoKSA9PiB7CiAgICAgICAgaWYgKHRoaXMucHVzaE5vdGlmaSkgewogICAgICAgICAgbGV0IG1lc3NhZ2U6IGFueSA9ICcnCiAgICAgICAgICBtZXNzYWdlID0gdGhpcy4kdCgnbm90aWZ5LnNlbmQtY29kZScpCiAgICAgICAgICB0aGlzLiRtZXNzYWdlLnN1Y2Nlc3MoeyBtZXNzYWdlLCBkdXJhdGlvbjogNTAwMCB9KQogICAgICAgIH0KICAgICAgfSkKICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHsKICAgICAgbGV0IG1lc3NhZ2U6IGFueSA9ICcnCiAgICAgIGNvbnN0IHsgY29uZmlnLCBkYXRhIH0gPSBlcnJvci5yZXNwb25zZQogICAgICBpZiAoZGF0YS5zdGF0dXMgPT09ICdVU0VSX0JMT0NLRUQnICYmIGluY2x1ZGVzKGNvbmZpZy51cmwsICdyZXNlbmRDb2RlJykpIHsKICAgICAgICBtZXNzYWdlID0gdGhpcy4kdCgnbm90aWZ5LnVzZXItYmxvY2tlZC1yZXNlbmQtY29kZScpCiAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcih7IG1lc3NhZ2UsIGR1cmF0aW9uOiA1MDAwIH0pCiAgICAgIH0KICAgIH0KICAgIHRoaXMucHVzaE5vdGlmaSA9IGZhbHNlCiAgfQoKICBoYW5kbGVPcGVuKCk6IHZvaWQgewogICAgdGhpcy5oYW5kbGVTZW5kQ29kZSgpCiAgfQoKICBoYW5kbGVTdWJtaXQoKTogdm9pZCB7CiAgICAvL0B0cy1pZ25vcmUKICAgIHRoaXMuJHJlZnNbJ2Zvcm0tdmVyaWZ5J10/LnZhbGlkYXRlKHZhbGlkID0+IHsKICAgICAgaWYgKHZhbGlkKSB7CiAgICAgICAgdGhpcy5kZWJvdW5jZUZpbHRlcignaGFuZGxlU3VibWl0JykKICAgICAgfQogICAgfSkKICB9CiAgYXN5bmMgc3VibWl0KCk6IFByb21pc2U8dm9pZD4gewogICAgdHJ5IHsKICAgICAgdGhpcy5pc0xvYWRpbmcgPSB0cnVlCiAgICAgIGNvbnN0IGRhdGEgPSB7CiAgICAgICAgZW1haWw6IHRoaXMuaW5mby5lbWFpbCwKICAgICAgICB2ZXJpZmljYXRpb25Db2RlOiB0aGlzLmZvcm0uY29kZSwKICAgICAgICB0eXBlOiAnU01TJwogICAgICB9CiAgICAgIGFwaUF1dGgKICAgICAgICAudmVyaWZ5Q29kZSgnQ09ERScsIHsgLi4uZGF0YSB9KQogICAgICAgIC50aGVuKCgpID0+IHsKICAgICAgICAgIHRoaXMuc2V0T3BlblBvcHVwKHsKICAgICAgICAgICAgcG9wdXBOYW1lOiAncG9wdXAtdmVyaWZpZWQtc21zJywKICAgICAgICAgICAgaXNPcGVuOiBmYWxzZQogICAgICAgICAgfSkKICAgICAgICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2UKICAgICAgICAgIHRoaXMuJGVtaXQoJ2ZvbGxvdzJmYScpCiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goZXJyID0+IHsKICAgICAgICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2UKICAgICAgICB9KQogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZQogICAgfQogIH0KfQo="},{"version":3,"sources":["PopupVerifiedSms.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6BA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"PopupVerifiedSms.vue","sourceRoot":"src/modules/setting/components/popup","sourcesContent":["<template>\r\n  <base-popup name=\"popup-verified-sms\" class=\"popup-verify\" width=\"480px\" :open=\"handleOpen\" :close=\"handleClose\" :isShowFooter=\"false\">\r\n    <div slot=\"title\">\r\n      <span>{{ $t('popup.title.verification') }} </span>\r\n    </div>\r\n    <div class=\"content\">\r\n      <h3 class=\"text-2xl text-center text-semibold title-form\">{{ $t('verified.titleContent2') }}</h3>\r\n      <div class=\"be-flex verify-code\">\r\n        <base-icon icon=\"verify-phone\" size=\"80\"></base-icon>\r\n        <div class=\"ml-1 w-100 input-code\">\r\n          <el-form :model=\"form\" :rules=\"rules\" ref=\"form-verify\" @submit.prevent.native=\"handleSubmit\">\r\n            <el-form-item prop=\"code\" :label=\"`${$t('verify.label')}`\" class=\"no-require-label\">\r\n              <el-input type=\"text\" v-model.trim=\"form.code\" maxlength=\"6\" :placeholder=\"`${$t('verify.placeholder')}`\" />\r\n            </el-form-item>\r\n          </el-form>\r\n        </div>\r\n      </div>\r\n      <el-button :loading=\"isLoading\" class=\"btn w-100 is-none-border cursor btn-submit btn-theme\" @click=\"handleSubmit\">{{ $t('verify.submit') }} </el-button>\r\n      <div class=\"text-base be-flex jc-space-center mt-24 mb-24 text-grey-130 text-discript\">\r\n        {{ $t('verify.question') }} &nbsp;<span class=\"text-hyperlink text-semibold cursor\" @click=\"handleResendCode\"> {{ $t('verify.re-send') }} </span>\r\n      </div>\r\n      <!-- <div style=\"padding-bottom: 24px\" class=\"text-base be-flex jc-space-center mt-12 text-grey-130 note-style use-voice-call\">\r\n        <span class=\"text-hyperlink text-semibold cursor\" @click=\"handleCallSendCode\"> {{ $t('verify.voice-call') }}</span>\r\n      </div> -->\r\n    </div>\r\n  </base-popup>\r\n</template>\r\n\r\n<script lang=\"ts\">\r\n  import { Component, Mixins, Prop, Watch } from 'vue-property-decorator'\r\n  import PopupMixin from '@/mixins/popup'\r\n\r\n  import getRepository from '@/services'\r\n  import WalletRepository from '@/services/repositories/wallet'\r\n  import { SettingRepository } from '@/services/repositories/setting'\r\n  import { AuthRepository } from '@/services/repositories/auth'\r\n  import debounce from 'lodash/debounce'\r\n  import { namespace } from 'vuex-class'\r\n  import { IUser } from '@/interface'\r\n  import includes from 'lodash/includes'\r\n  const bcAuth = namespace('beAuth')\r\n  const apiAuth: AuthRepository = getRepository('auth')\r\n  const api: SettingRepository = getRepository('setting')\r\n  @Component\r\n  export default class PopupVerifySms extends Mixins(PopupMixin) {\r\n    @bcAuth.State('user') user!: IUser\r\n    @Prop({ required: true, type: Object, default: () => ({}) }) info!: Record<string, any>\r\n\r\n    form: Record<string, any> = {\r\n      code: ''\r\n    }\r\n    isLoading = false\r\n    success: any = 0\r\n    rules: Record<string, any> = {\r\n      code: [\r\n        {\r\n          required: true,\r\n          message: this.$t('verify.wrong-code'),\r\n          trigger: 'blur'\r\n        },\r\n        {\r\n          len: 6,\r\n          message: this.$t('changePassword.errorLengthVerificationCode'),\r\n          trigger: 'blur'\r\n        }\r\n      ]\r\n    }\r\n    get getDisableBtn(): boolean {\r\n      return this.form.code.length !== 6\r\n    }\r\n\r\n    @Watch('form.code') watchCode(code: string): void {\r\n      if (code) {\r\n        //@ts-ignore\r\n        this.$refs['form-verify']?.clearValidate()\r\n      }\r\n    }\r\n\r\n    // debounce chan doble click\r\n    debounceFilter = debounce((nameAction: any) => {\r\n      if (nameAction == 'handleResendCode') {\r\n        this.resendCode()\r\n      }\r\n      if (nameAction == 'handleSubmit') {\r\n        this.submit()\r\n      }\r\n    }, 400)\r\n    handleResendCode(): void {\r\n      this.debounceFilter('handleResendCode')\r\n    }\r\n    pushNotifi = false\r\n    async resendCode(): Promise<void> {\r\n      this.pushNotifi = true\r\n      this.handleSendCode()\r\n    }\r\n    handleCallSendCode(): void {\r\n      api.getProfile().then((res: any) => {\r\n        const data = {\r\n          country: res.data.country,\r\n          phone: this.info.phone,\r\n          countryCode: res.data.countryCode,\r\n          email: this.info.email,\r\n          phoneCall: true\r\n        }\r\n        let message: any = ''\r\n        apiAuth.verifyPhone(data).then(() => {\r\n          message = this.$t('notify.send-code-voice')\r\n          this.$message.success({ message, duration: 5000 })\r\n        })\r\n      })\r\n    }\r\n    handleReset(): void {\r\n      //@ts-ignore\r\n      this.$refs['form-verify']?.clearValidate()\r\n      this.form = {\r\n        code: ''\r\n      }\r\n    }\r\n    handleClose(): void {\r\n      this.handleReset()\r\n    }\r\n\r\n    async handleSendCode(): Promise<void> {\r\n      try {\r\n        const data = {\r\n          email: this.info.email,\r\n          type: 'SMS',\r\n          reason: ''\r\n        }\r\n        await apiAuth.resendCode(data).then(() => {\r\n          if (this.pushNotifi) {\r\n            let message: any = ''\r\n            message = this.$t('notify.send-code')\r\n            this.$message.success({ message, duration: 5000 })\r\n          }\r\n        })\r\n      } catch (error: any) {\r\n        let message: any = ''\r\n        const { config, data } = error.response\r\n        if (data.status === 'USER_BLOCKED' && includes(config.url, 'resendCode')) {\r\n          message = this.$t('notify.user-blocked-resend-code')\r\n          this.$message.error({ message, duration: 5000 })\r\n        }\r\n      }\r\n      this.pushNotifi = false\r\n    }\r\n\r\n    handleOpen(): void {\r\n      this.handleSendCode()\r\n    }\r\n\r\n    handleSubmit(): void {\r\n      //@ts-ignore\r\n      this.$refs['form-verify']?.validate(valid => {\r\n        if (valid) {\r\n          this.debounceFilter('handleSubmit')\r\n        }\r\n      })\r\n    }\r\n    async submit(): Promise<void> {\r\n      try {\r\n        this.isLoading = true\r\n        const data = {\r\n          email: this.info.email,\r\n          verificationCode: this.form.code,\r\n          type: 'SMS'\r\n        }\r\n        apiAuth\r\n          .verifyCode('CODE', { ...data })\r\n          .then(() => {\r\n            this.setOpenPopup({\r\n              popupName: 'popup-verified-sms',\r\n              isOpen: false\r\n            })\r\n            this.isLoading = false\r\n            this.$emit('follow2fa')\r\n          })\r\n          .catch(err => {\r\n            this.isLoading = false\r\n          })\r\n      } catch (error) {\r\n        this.isLoading = false\r\n      }\r\n    }\r\n  }\r\n</script>\r\n\r\n<style scoped lang=\"scss\">\r\n  .btn {\r\n    padding: 12px 0 !important;\r\n    font-size: 16px !important;\r\n    line-height: 24px !important;\r\n  }\r\n  .title-form {\r\n    color: #201f1e;\r\n    margin-bottom: 3px;\r\n    word-break: break-word;\r\n  }\r\n  .input-code {\r\n    margin-top: 17px;\r\n  }\r\n  .btn-submit {\r\n    margin-bottom: 24px;\r\n  }\r\n  .text-discript {\r\n    margin-top: 0px !important;\r\n  }\r\n  .btn-theme {\r\n    background: var(--bc-tab-active);\r\n    &:focus {\r\n      color: var(--bc-color-white);\r\n    }\r\n  }\r\n  .btn-theme:hover {\r\n    border: none;\r\n    color: var(--bc-color-white);\r\n    background: var(--bc-theme-primary-gradient-hover);\r\n  }\r\n  @media screen and (max-width: 768px) {\r\n    ::v-deep.popup-verify{\r\n      .el-dialog{\r\n        width: 335px !important;\r\n        &__header{\r\n          .title{\r\n            font-weight: 600;\r\n            font-size: 16px;\r\n            line-height: 24px;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n</style>\r\n"]}]}