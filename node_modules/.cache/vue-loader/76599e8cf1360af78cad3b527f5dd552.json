{"remainingRequest":"D:\\NEU\\CDTT\\frontend\\Website\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\NEU\\CDTT\\frontend\\Website\\src\\modules\\setting\\components\\popup\\PopupVerifyPhone.vue?vue&type=script&lang=ts&","dependencies":[{"path":"D:\\NEU\\CDTT\\frontend\\Website\\src\\modules\\setting\\components\\popup\\PopupVerifyPhone.vue","mtime":1660123011576},{"path":"D:\\NEU\\CDTT\\frontend\\Website\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1660970364629},{"path":"D:\\NEU\\CDTT\\frontend\\Website\\node_modules\\babel-loader\\lib\\index.js","mtime":1660970387821},{"path":"D:\\NEU\\CDTT\\frontend\\Website\\node_modules\\ts-loader\\index.js","mtime":1660970390648},{"path":"D:\\NEU\\CDTT\\frontend\\Website\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1660970364629},{"path":"D:\\NEU\\CDTT\\frontend\\Website\\node_modules\\vue-loader\\lib\\index.js","mtime":1660970394220}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgppbXBvcnQgeyBDb21wb25lbnQsIE1peGlucywgUHJvcCwgV2F0Y2ggfSBmcm9tICd2dWUtcHJvcGVydHktZGVjb3JhdG9yJwppbXBvcnQgUG9wdXBNaXhpbiBmcm9tICdAL21peGlucy9wb3B1cCcKCmltcG9ydCBnZXRSZXBvc2l0b3J5IGZyb20gJ0Avc2VydmljZXMnCgppbXBvcnQgZGVib3VuY2UgZnJvbSAnbG9kYXNoL2RlYm91bmNlJwppbXBvcnQgaW5jbHVkZXMgZnJvbSAnbG9kYXNoL2luY2x1ZGVzJwppbXBvcnQgeyBTZXR0aW5nUmVwb3NpdG9yeSB9IGZyb20gJ0Avc2VydmljZXMvcmVwb3NpdG9yaWVzL3NldHRpbmcnCgpjb25zdCBhcGlTZXR0aW5nOiBTZXR0aW5nUmVwb3NpdG9yeSA9IGdldFJlcG9zaXRvcnkoJ3NldHRpbmcnKQoKQENvbXBvbmVudApleHBvcnQgZGVmYXVsdCBjbGFzcyBQb3B1cFZlcmlmeVBob25lIGV4dGVuZHMgTWl4aW5zKFBvcHVwTWl4aW4pIHsKICBAUHJvcCh7IHJlcXVpcmVkOiB0cnVlLCB0eXBlOiBPYmplY3QsIGRlZmF1bHQ6ICgpID0+ICh7fSkgfSkgZGF0YSE6IFJlY29yZDxzdHJpbmcsIGFueT4KICBmb3JtOiBSZWNvcmQ8c3RyaW5nLCBhbnk+ID0gewogICAgdmVyaWZpY2F0aW9uQ29kZTogJycKICB9CiAgaXNMb2FkaW5nID0gZmFsc2UKICBzdWNjZXNzOiBhbnkgPSAwCiAgcnVsZXM6IFJlY29yZDxzdHJpbmcsIGFueT4gPSB7CiAgICB2ZXJpZmljYXRpb25Db2RlOiBbCiAgICAgIHsKICAgICAgICByZXF1aXJlZDogdHJ1ZSwKICAgICAgICBtZXNzYWdlOiB0aGlzLiR0KCd2ZXJpZnkud3JvbmctY29kZScpLAogICAgICAgIHRyaWdnZXI6ICdibHVyJwogICAgICB9LAogICAgICB7CiAgICAgICAgbGVuOiA2LAogICAgICAgIG1lc3NhZ2U6IHRoaXMuJHQoJ2NoYW5nZVBhc3N3b3JkLmVycm9yTGVuZ3RoVmVyaWZpY2F0aW9uQ29kZScpLAogICAgICAgIHRyaWdnZXI6ICdibHVyJwogICAgICB9CiAgICBdCiAgfQogIGdldCBnZXREaXNhYmxlQnRuKCk6IGJvb2xlYW4gewogICAgcmV0dXJuIHRoaXMuZm9ybS52ZXJpZmljYXRpb25Db2RlLmxlbmd0aCAhPT0gNgogIH0KCiAgZ2V0IGdldEljb24oKTogc3RyaW5nIHsKICAgIGNvbnN0IG5hbWUgPSB0aGlzLiRyb3V0ZS5uYW1lCiAgICBpZiAobmFtZSA9PT0gJ3ZlcmlmeS1waG9uZScpIHsKICAgICAgcmV0dXJuICd2ZXJpZnktcGhvbmUnCiAgICB9CiAgICBpZiAobmFtZSA9PT0gJ3ZlcmlmeS1lbWFpbCcpIHsKICAgICAgcmV0dXJuICd2ZXJpZnktZW1haWwnCiAgICB9CiAgICByZXR1cm4gJ3ZlcmlmeS1hcHAnCiAgfQoKICBAV2F0Y2goJ2Zvcm0udmVyaWZpY2F0aW9uQ29kZScpIHdhdGNoQ29kZShjb2RlOiBzdHJpbmcpOiB2b2lkIHsKICAgIGlmIChjb2RlKSB7CiAgICAgIC8vQHRzLWlnbm9yZQogICAgICB0aGlzLiRyZWZzWydmb3JtLXZlcmlmeSddPy5jbGVhclZhbGlkYXRlKCkKICAgIH0KICB9CgogIC8vIGdldCBnZXRUaXR0bGUoKTogc3RyaW5nIHwgYW55IHsKICAvLyAgIGNvbnN0IG5hbWUgPSB0aGlzLiRyb3V0ZS5uYW1lCiAgLy8gICBpZiAobmFtZSA9PT0gJ3ZlcmlmeS1waG9uZScpIHsKICAvLyAgICAgcmV0dXJuIHRoaXMuJHQoJ3ZlcmlmeS50aXRsZS1waG9uZScpCiAgLy8gICB9CiAgLy8gICBpZiAobmFtZSA9PT0gJ3ZlcmlmeS1lbWFpbCcpIHsKICAvLyAgICAgcmV0dXJuIHRoaXMuJHQoJ3ZlcmlmeS50aXRsZS1lbWFpbCcpCiAgLy8gICB9CiAgLy8gICByZXR1cm4gdGhpcy4kdCgndmVyaWZ5LnRpdGxlLWFwcCcpCiAgLy8gfQogIC8vIGRlYm91bmNlIGNoYW4gZG9ibGUgY2xpY2sKICBkZWJvdW5jZUZpbHRlciA9IGRlYm91bmNlKChuYW1lQWN0aW9uOiBhbnkpID0+IHsKICAgIGlmIChuYW1lQWN0aW9uID09ICdoYW5kbGVSZXNlbmRDb2RlJykgewogICAgICB0aGlzLnJlc2VuZENvZGUoKQogICAgfQogICAgaWYgKG5hbWVBY3Rpb24gPT0gJ2hhbmRsZVN1Ym1pdCcpIHsKICAgICAgdGhpcy5zdWJtaXQoKQogICAgfQogIH0sIDQwMCkKICBoYW5kbGVSZXNlbmRDb2RlKCk6IHZvaWQgewogICAgdGhpcy5kZWJvdW5jZUZpbHRlcignaGFuZGxlUmVzZW5kQ29kZScpCiAgfQogIGFzeW5jIHJlc2VuZENvZGUoKTogUHJvbWlzZTx2b2lkPiB7CiAgICBsZXQgbWVzc2FnZTogYW55ID0gJycKICAgIGFwaVNldHRpbmcKICAgICAgLmNoYW5nZVBob25lKHRoaXMuZGF0YSwgeyByZXNlbmRDb2RlOiAnbmV3JyB9KQogICAgICAudGhlbigoKSA9PiB7CiAgICAgICAgbWVzc2FnZSA9IHRoaXMuJHQoJ25vdGlmeS5zZW5kLWNvZGUnKQogICAgICAgIHRoaXMuJG1lc3NhZ2Uuc3VjY2Vzcyh7IG1lc3NhZ2UsIGR1cmF0aW9uOiA1MDAwIH0pCiAgICAgIH0pCiAgICAgIC5jYXRjaChlcnJvciA9PiB7CiAgICAgICAgbGV0IG1lc3NhZ2U6IGFueSA9ICcnCiAgICAgICAgY29uc3QgeyBjb25maWcsIGRhdGEgfSA9IGVycm9yLnJlc3BvbnNlCgogICAgICAgIGlmIChkYXRhLnN0YXR1cyA9PT0gJ1VTRVJfQkxPQ0tFRCcgJiYgaW5jbHVkZXMoY29uZmlnLnVybCwgJ3Jlc2VuZENvZGUnKSkgewogICAgICAgICAgbWVzc2FnZSA9IHRoaXMuJHQoJ25vdGlmeS51c2VyLWJsb2NrZWQtcmVzZW5kLWNvZGUnKQogICAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcih7IG1lc3NhZ2UsIGR1cmF0aW9uOiA1MDAwIH0pCiAgICAgICAgfQogICAgICAgIGlmIChkYXRhLnN0YXR1cyA9PT0gJ1VTRVJfTE9DS0VEJyAmJiBpbmNsdWRlcyhjb25maWcudXJsLCAncmVzZW5kQ29kZScpKSB7CiAgICAgICAgICBtZXNzYWdlID0gdGhpcy4kdCgnbm90aWZ5LnVzZXItbG9ja2VkLXJlc2VuZC1jb2RlJykKICAgICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IoeyBtZXNzYWdlLCBkdXJhdGlvbjogNTAwMCB9KQogICAgICAgIH0KICAgICAgfSkKICB9CiAgaGFuZGxlUmVzZXQoKTogdm9pZCB7CiAgICB0aGlzLmZvcm0gPSB7CiAgICAgIHZlcmlmaWNhdGlvbkNvZGU6ICcnCiAgICB9CiAgICB0aGlzLnN1Y2Nlc3MgPSAwCiAgfQogIGhhbmRsZUNsb3NlKCk6IHZvaWQgewogICAgLy9AdHMtaWdub3JlCiAgICB0aGlzLiRyZWZzWydmb3JtLXZlcmlmeSddLmNsZWFyVmFsaWRhdGUoKQogICAgdGhpcy5oYW5kbGVSZXNldCgpCiAgfQogIGhhbmRsZU9wZW4oKTogdm9pZCB7CiAgICBjb25zb2xlLmxvZygnb3BlbicpCiAgfQogIGhhbmRsZVN1Ym1pdCgpOiB2b2lkIHsKICAgIHRoaXMuZGVib3VuY2VGaWx0ZXIoJ2hhbmRsZVN1Ym1pdCcpCiAgfQogIGFzeW5jIHN1Ym1pdCgpOiBQcm9taXNlPHZvaWQ+IHsKICAgIC8vQHRzLWlnbm9yZQogICAgdGhpcy4kcmVmc1snZm9ybS12ZXJpZnknXT8udmFsaWRhdGUoYXN5bmMgdmFsaWQgPT4gewogICAgICBpZiAodmFsaWQpIHsKICAgICAgICB0aGlzLmlzTG9hZGluZyA9IHRydWUKICAgICAgICBjb25zdCBkYXRhID0gewogICAgICAgICAgLi4udGhpcy5kYXRhLAogICAgICAgICAgdmVyaWZpY2F0aW9uQ29kZU9sZFBob25lOiBudWxsLAogICAgICAgICAgdmVyaWZpY2F0aW9uQ29kZU5ld1Bob25lOiB0aGlzLmZvcm0udmVyaWZpY2F0aW9uQ29kZQogICAgICAgIH0KICAgICAgICBhcGlTZXR0aW5nCiAgICAgICAgICAuY2hhbmdlUGhvbmVWZXJpZmljYXRpb24oZGF0YSkKICAgICAgICAgIC50aGVuKCgpID0+IHsKICAgICAgICAgICAgbGV0IG1lc3NhZ2U6IGFueSA9ICcnCiAgICAgICAgICAgIG1lc3NhZ2UgPSB0aGlzLiR0KCdub3RpZnkudmVyaWZ5LXN1Y2Nlc3MnKQogICAgICAgICAgICB0aGlzLiRtZXNzYWdlLnN1Y2Nlc3MoeyBtZXNzYWdlLCBkdXJhdGlvbjogNTAwMCB9KQogICAgICAgICAgICB0aGlzLnNldE9wZW5Qb3B1cCh7CiAgICAgICAgICAgICAgcG9wdXBOYW1lOiAncG9wdXAtdmVyaWZ5LXBob25lJywKICAgICAgICAgICAgICBpc09wZW46IGZhbHNlCiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIHRoaXMuJGVtaXQoJ3JlbG9hZCcpCiAgICAgICAgICB9KQogICAgICAgICAgLmNhdGNoKCgpID0+IHsKICAgICAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZQogICAgICAgICAgfSkKICAgICAgfQogICAgfSkKICB9Cn0K"},{"version":3,"sources":["PopupVerifyPhone.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AA0BA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"PopupVerifyPhone.vue","sourceRoot":"src/modules/setting/components/popup","sourcesContent":["<template>\r\n  <base-popup name=\"popup-verify-phone\" class=\"popup-verify\" width=\"480px\" :open=\"handleOpen\" :close=\"handleClose\" :isShowFooter=\"false\">\r\n    <div slot=\"title\">\r\n      <span>{{ $t('popup.title.verification') }}</span>\r\n    </div>\r\n    <div class=\"content\">\r\n      <h3 class=\"text-2xl text-center text-semibold title-form\">{{ $t('verified.titleContent2') }}</h3>\r\n      <div class=\"be-flex verify-code\">\r\n        <base-icon icon=\"verify-phone\" size=\"80\"></base-icon>\r\n        <div class=\"ml-1 w-100 input-code\">\r\n          <el-form :model=\"form\" :rules=\"rules\" ref=\"form-verify\" @submit.prevent.native=\"handleSubmit\">\r\n            <el-form-item prop=\"verificationCode\" :label=\"`${$t('verify.label')}`\" class=\"no-require-label\">\r\n              <el-input type=\"text\" v-model.trim=\"form.verificationCode\" maxlength=\"6\" :placeholder=\"`${$t('verify.placeholder')}`\" />\r\n            </el-form-item>\r\n          </el-form>\r\n        </div>\r\n      </div>\r\n      <el-button :loading=\"isLoading\" class=\"btn w-100 is-none-border cursor btn-submit btn-theme\" @click=\"handleSubmit\">{{ $t('verify.submit') }} </el-button>\r\n      <div class=\"text-base be-flex jc-space-center mt-24 mb-24 text-grey-130 text-discript\">\r\n        {{ $t('verify.question') }} &nbsp;<span class=\"text-hyperlink text-semibold cursor\" @click=\"handleResendCode\"> {{ $t('verify.re-send') }} </span>\r\n      </div>\r\n    </div>\r\n  </base-popup>\r\n</template>\r\n\r\n<script lang=\"ts\">\r\n  import { Component, Mixins, Prop, Watch } from 'vue-property-decorator'\r\n  import PopupMixin from '@/mixins/popup'\r\n\r\n  import getRepository from '@/services'\r\n\r\n  import debounce from 'lodash/debounce'\r\n  import includes from 'lodash/includes'\r\n  import { SettingRepository } from '@/services/repositories/setting'\r\n\r\n  const apiSetting: SettingRepository = getRepository('setting')\r\n\r\n  @Component\r\n  export default class PopupVerifyPhone extends Mixins(PopupMixin) {\r\n    @Prop({ required: true, type: Object, default: () => ({}) }) data!: Record<string, any>\r\n    form: Record<string, any> = {\r\n      verificationCode: ''\r\n    }\r\n    isLoading = false\r\n    success: any = 0\r\n    rules: Record<string, any> = {\r\n      verificationCode: [\r\n        {\r\n          required: true,\r\n          message: this.$t('verify.wrong-code'),\r\n          trigger: 'blur'\r\n        },\r\n        {\r\n          len: 6,\r\n          message: this.$t('changePassword.errorLengthVerificationCode'),\r\n          trigger: 'blur'\r\n        }\r\n      ]\r\n    }\r\n    get getDisableBtn(): boolean {\r\n      return this.form.verificationCode.length !== 6\r\n    }\r\n\r\n    get getIcon(): string {\r\n      const name = this.$route.name\r\n      if (name === 'verify-phone') {\r\n        return 'verify-phone'\r\n      }\r\n      if (name === 'verify-email') {\r\n        return 'verify-email'\r\n      }\r\n      return 'verify-app'\r\n    }\r\n\r\n    @Watch('form.verificationCode') watchCode(code: string): void {\r\n      if (code) {\r\n        //@ts-ignore\r\n        this.$refs['form-verify']?.clearValidate()\r\n      }\r\n    }\r\n\r\n    // get getTittle(): string | any {\r\n    //   const name = this.$route.name\r\n    //   if (name === 'verify-phone') {\r\n    //     return this.$t('verify.title-phone')\r\n    //   }\r\n    //   if (name === 'verify-email') {\r\n    //     return this.$t('verify.title-email')\r\n    //   }\r\n    //   return this.$t('verify.title-app')\r\n    // }\r\n    // debounce chan doble click\r\n    debounceFilter = debounce((nameAction: any) => {\r\n      if (nameAction == 'handleResendCode') {\r\n        this.resendCode()\r\n      }\r\n      if (nameAction == 'handleSubmit') {\r\n        this.submit()\r\n      }\r\n    }, 400)\r\n    handleResendCode(): void {\r\n      this.debounceFilter('handleResendCode')\r\n    }\r\n    async resendCode(): Promise<void> {\r\n      let message: any = ''\r\n      apiSetting\r\n        .changePhone(this.data, { resendCode: 'new' })\r\n        .then(() => {\r\n          message = this.$t('notify.send-code')\r\n          this.$message.success({ message, duration: 5000 })\r\n        })\r\n        .catch(error => {\r\n          let message: any = ''\r\n          const { config, data } = error.response\r\n\r\n          if (data.status === 'USER_BLOCKED' && includes(config.url, 'resendCode')) {\r\n            message = this.$t('notify.user-blocked-resend-code')\r\n            this.$message.error({ message, duration: 5000 })\r\n          }\r\n          if (data.status === 'USER_LOCKED' && includes(config.url, 'resendCode')) {\r\n            message = this.$t('notify.user-locked-resend-code')\r\n            this.$message.error({ message, duration: 5000 })\r\n          }\r\n        })\r\n    }\r\n    handleReset(): void {\r\n      this.form = {\r\n        verificationCode: ''\r\n      }\r\n      this.success = 0\r\n    }\r\n    handleClose(): void {\r\n      //@ts-ignore\r\n      this.$refs['form-verify'].clearValidate()\r\n      this.handleReset()\r\n    }\r\n    handleOpen(): void {\r\n      console.log('open')\r\n    }\r\n    handleSubmit(): void {\r\n      this.debounceFilter('handleSubmit')\r\n    }\r\n    async submit(): Promise<void> {\r\n      //@ts-ignore\r\n      this.$refs['form-verify']?.validate(async valid => {\r\n        if (valid) {\r\n          this.isLoading = true\r\n          const data = {\r\n            ...this.data,\r\n            verificationCodeOldPhone: null,\r\n            verificationCodeNewPhone: this.form.verificationCode\r\n          }\r\n          apiSetting\r\n            .changePhoneVerification(data)\r\n            .then(() => {\r\n              let message: any = ''\r\n              message = this.$t('notify.verify-success')\r\n              this.$message.success({ message, duration: 5000 })\r\n              this.setOpenPopup({\r\n                popupName: 'popup-verify-phone',\r\n                isOpen: false\r\n              })\r\n              this.$emit('reload')\r\n            })\r\n            .catch(() => {\r\n              this.isLoading = false\r\n            })\r\n        }\r\n      })\r\n    }\r\n  }\r\n</script>\r\n\r\n<style scoped lang=\"scss\">\r\n  .btn {\r\n    padding: 12px 0 !important;\r\n    font-size: 16px !important;\r\n    line-height: 24px !important;\r\n  }\r\n  .title-form {\r\n    color: #201f1e;\r\n    margin-bottom: 3px;\r\n    word-break: break-word;\r\n  }\r\n  .input-code {\r\n    margin-top: 17px;\r\n  }\r\n  .btn-submit {\r\n    margin-bottom: 24px;\r\n  }\r\n  .text-discript {\r\n    margin-top: 0px !important;\r\n  }\r\n  .btn-theme {\r\n    background: var(--bc-tab-active);\r\n    color: #fff;\r\n  }\r\n  .btn-theme:hover {\r\n    border: none;\r\n    color: var(--bc-color-white);\r\n    background: var(--bc-theme-primary-gradient-hover);\r\n  }\r\n  @media screen and (max-width: 768px) {\r\n    ::v-deep.popup-verify{\r\n      .el-dialog{\r\n        width: 335px !important;\r\n        &__header{\r\n          .title{\r\n            font-weight: 600;\r\n            font-size: 16px;\r\n            line-height: 24px;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n</style>\r\n"]}]}